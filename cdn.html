<script>
  // ‚ö° –ü–û–õ–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –°–ö–†–ò–ü–¢–ê –ò –°–¢–ò–õ–ï–ô –° –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–û–ô
  ;(function () {
    const HOST = "http://localhost:5501"
    let lastJsVersion = null
    let lastCssVersion = null

    // –ó–∞–≥—Ä—É–∑–∏—Ç—å CSS —Å—Ç–∏–ª–∏
    function loadCSS() {
      const timestamp = Date.now()
      const css = document.createElement("link")
      css.rel = "stylesheet"
      css.type = "text/css"
      css.href = `${HOST}/styles.css?t=${timestamp}`
      document.head.appendChild(css)
    }

    // –ó–∞–≥—Ä—É–∑–∏—Ç—å JavaScript
    function loadJS() {
      const timestamp = Date.now()
      const js = document.createElement("script")
      js.src = `${HOST}/app.js?t=${timestamp}`
      document.head.appendChild(js)
    }

    // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    loadCSS()
    loadJS()

    // –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
    setInterval(async () => {
      try {
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JS —Ñ–∞–π–ª
        const jsResponse = await fetch(`${HOST}/app.js?_=${Date.now()}`)
        const jsVersion = jsResponse.headers.get("last-modified") || jsResponse.headers.get("etag")

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSS —Ñ–∞–π–ª
        const cssResponse = await fetch(`${HOST}/styles.css?_=${Date.now()}`)
        const cssVersion = cssResponse.headers.get("last-modified") || cssResponse.headers.get("etag")

        // –ï—Å–ª–∏ JS –∏–∑–º–µ–Ω–∏–ª—Å—è - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        if (lastJsVersion && jsVersion !== lastJsVersion) {
          console.log("üîÑ JS –∏–∑–º–µ–Ω–µ–Ω, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...")
          window.location.reload()
          return
        }

        lastJsVersion = jsVersion

        // –ï—Å–ª–∏ CSS –∏–∑–º–µ–Ω–∏–ª—Å—è - –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∏–ª–∏
        if (lastCssVersion && cssVersion !== lastCssVersion) {
          console.log("üé® CSS –∏–∑–º–µ–Ω–µ–Ω, –æ–±–Ω–æ–≤–ª—è—é —Å—Ç–∏–ª–∏...")

          // –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å—Ç–∏–ª–∏
          document.querySelectorAll('link[href*="localhost:5500"]').forEach((link) => {
            if (link.href.includes("styles.css")) link.remove()
          })

          // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ
          loadCSS()
        }

        lastCssVersion = cssVersion
      } catch (error) {
        // –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      }
    }, 300) // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 300ms
  })()
</script>
